# 《一个基于室内定位的AR渲染方法》
- 目的：借助室内定位、人工智能、云计算、图像处理和图像识别等技术，实现室内
场景区域的框定，照片信息数据库的快速构建，AR场景渲染时图像的高效提取
和识别，达到真实场景AR生成，增强用户的现实场景及时化、精确化和真实化体验
- 步骤
    + 建立数据库：对室内场景进行分区域拍照，生成记录有拍摄位置、拍摄方向、拍摄角度信息(借助室内定位技术找到拍摄位置、拍摄方向、拍摄角度)的室内场景图片；对所述室内场景图片进行特征点信息提取(借助图像处理和图像识别技术)，建立包含有特征点信息的室内场景图片数据库(借助云计算)
    + 取景：利用移动设备的摄像头获取其当前所在室内位置、角度、方向信息的同时抓取即时预览图像，将所属预览图像与步骤一中所述的室内场景图片数据库进行匹配，确定最匹配室内场景图片
    + 计算偏差：计算所述预览图像相当于所述最匹配室内场景图片的偏差，所述偏差包括所述预览图像相对于所述最匹配室内场景图片的旋转角度。
    + AR呈现：计算所述最匹配室内场景图片在AR场景中的对应位置，调取相应的AR场景渲染素材；根本步骤三中的所述偏差调整最匹配室内场景图，将调整后的最匹配室内场景图显示在AR场景中，所述调整后的最匹配室内场景图与现实场景中的真实位置相对应，实现室内AR场景的渲染和生成。

- 说明
    + 拍摄位置：拍摄点的三轴坐标，坐标原点根据需求确定
    + 拍摄方向：相机中心线在水平面上的投影线与正北方向的夹角
    + 拍摄角度：相机中心线与水平面之间的夹角
    + 拍摄位置的确定采用蓝牙定位信标的室内定位技术
    + 包含有特征点的室内场景图片数据库上传到服务器或云端
    + 关于确定最匹配室内场景图片的方法
        * (对设备)根据移动设备当前所在的室内位置、角度、方向信息，从所述室内场景图片数据库筛选出备选图片组
        * (对图像)对预览图像进行特征点提取，与所述备选图片组进行特征点信息识别比对，确定最匹配室内场景图片
        * 备选图片组的筛选说明(阈值)
            - 拍摄位置：设备与备选图位置距离小于阈值(0.2m-20m)
            - 拍摄方向：设备与备选图方向偏差小于阈值(15°-25°)
            - 拍摄角度：设备与备选图扇形区域大于阈值(80%-90%)
        * 最匹配室内场景图片选取说明
            - 最多共同特征点的备选图片

- 工作
1. 建立包含有特征点信息的室内场景图片数据库
2. 确定与即时预览图像相对应的最匹配室内场景图片
3. 计算即时预览图像与最匹配室内场景图片的偏差
4. 调整最匹配室内场景图并显示在AR场景中，实现室内AR常见的渲染和生成

- 建立包含有特征点信息的室内场景图片数据库的步骤
1. 室内区域相机拍照
2. 生成带有位置、相机可视角度、深度和方向信息的照片
3. 生成照片的框定和裁剪
4. 上传至云端或服务器
5. 照片的特征化处理
6. 构建室内场景照片信息数据库

- 确定与即时预览图像相对应的最匹配室内场景图片的步骤
1. 进入室内，打开摄像头
2. 抓取当前摄像头图像信息，获取图像，特征化处理，做图像识别。
3. 获取当前位置、可是角度和方向，判断与上次从服务器请求的图片数据是否有差异，若有则依据位置、可视角度和方向从服务器上抽取备选图片，下载备选图片特征信息。做图像识别操作
4. 图像识别成功则获取原图片在AR场景中的真实位置，调取AR场景渲染材料
